{% extends "layout.html" %} {% block title %} {% endblock %} {% block main %}
<div class="border grid md:grid-cols-2 gap-4">
  <div class="section mx-8 lg:mx-10 w-full mb-10">
    <div>
      <h2
        class="text-2xl md:text-4xl font-semibold text-blue-800 items-left mb-0.5"
      >
        Hello, {{ username|capitalize }}
      </h2>
      <p class="text-sm md:text-md lg:text-lg font-thin">
        You have <strong>{{ cash|usd }}</strong> available to buy stocks.
      </p>
    </div>
    <div class="flex flex-cols my-4">
      <p class="w-1/2 p-2 border text-xs md:text-sm shadow-md font-semibold">
        Buy to invest now
      </p>
      <a
        href="/quote"
        class="w-1/3 text-center text-yellow-400 bg-blue-800 text-sm md:text-base hover:bg-blue-500 font-bold py-2 px-4 rounded-r-md shadow-md focus:outline-none focus:shadow-outline"
      >
        Quote & Buy
      </a>
    </div>
    <div class="flex flex-cols flex my-4">
      <p class="w-1/2 p-2 border text-xs md:text-sm shadow-md font-semibold">
        Turn stock to cash
      </p>
      <a
        href="/sell"
        class="w-1/3 text-center text-blue-800 bg-yellow-400 hover:bg-blue-500 text-sm md:text-base font-bold py-2 px-4 rounded-r-md shadow-md focus:outline-none focus:shadow-outline"
      >
        Sell
      </a>
    </div>
    <div class="flex lg:flex-row md:m-10 mt-10 max-w-lg overflow-hidden">
      <!-- Leaderboard section -->
      <div class="md:w-4/5">
        <p class="text-sm md:text-md lg:text-lg font-thin py-3 md:py-5">
          See how well you're performing compared to others.
        </p>
        <div class="border border-blue-800 shadow-md rounded-md p-3 md:p-5">
          <h2
            class="text-base md:text-lg font-bold p-2 text-blue-800 border-b-2 border-blue-200"
          >
            Leaderboard
          </h2>
          <div
            class="grid grid-cols-4 border-b-2 border-blue-200 py-2 tracking-tight text-xs md:text-sm font-semibold"
          >
            <h5 class="ml-2 text-left">Rank</h5>
            <h5 class="-ml-5 text-left">Username</h5>
            <h5 class="-ml-2 text-left">Equity Value</h5>
            <h5>Gain/Loss %</h5>
          </div>
          {% for each in leaderboard %}
          <div class="grid grid-cols-4 py-2 text-xs md:text-sm">
            <div class="ml-4 font-light text-left">{{ loop.index }}</div>
            <div class="-ml-5 font-light text-left">{{ each.username }}</div>
            <div class="font-light">{{ each.equity_value|usd }}</div>
            {% if each.net_gain_loss >= 0 %}
            <div class="font-semibold text-green-800 text-left">
              +{{ (each.net_gain_loss/10000)|percent }}
            </div>
            {% else %}
            <div class="font-semibold text-red-800 text-left">
              {{ (each.net_gain_loss/10000)|percent }}
            </div>
            {% endif %}
          </div>
          {% endfor %} 
          {% if not isLeader %}
          <div class="grid grid-cols-4 py-2 text-xs md:text-sm border-2 border-blue-700 rounded-md">
            <div class="ml-4 font-light text-left">{{ (rank+1) }}</div>
            <div class="-ml-5 font-light text-left">{{ username }}</div>
            <div class="font-light">{{ equity_value|usd }}</div>
            {% if net_gain_loss >= 0 %}
            <div class="font-semibold text-green-800 text-left">
              +{{ (net_gain_loss/10000)|percent }}
            </div>
            {% else %}
            <div class="font-semibold text-red-800 text-left">
              {{ (net_gain_loss/10000)|percent }}
            </div>
            {% endif %}
          </div>
        </div>
        {% endif %}
      </div>
      {% if isLeader %}
      <p class="py-3 md:py-5 text-sm md:text-md lg:text-lg font-thin mb-2 items-left">
        Nice! You got the
        <strong class="text-blue-600 tracking-wide p-1 font-bold"
          >{{ (rank+1)|ordinal }}</strong
        >
        rank in the leaderboard!
      </p>
      {% endif %}
    </div>
  </div>
  <div class="section md:w-4/5 gap-0 md:gap-4 container px-5 overflow-hidden">
    <h2 class="text-xl md:text-3xl font-bold text-blue-800">
      Portfolio Dashboard
    </h2>
    {% if (cash + total_share_value - 10000) > 0 %}
    <p class="text-sm md:text-md lg:text-lg font-thin mb-4 items-left">
      You have a total net profit so far is
      <strong class="text-green-700"
        >{{ (cash + total_share_value - 10000)|usd }}</strong
      >!
    </p>
    {% else %}
    <p class="text-sm md:text-md lg:text-lg font-thin mb-4 items-left">
      Your total net loss so far is
      <strong class="text-red-700"
        >{{ (10000 - (cash + total_share_value))|usd }}</strong
      >.
    </p>
    {% endif %}
    <div
      class="grid grid-cols-5 border-b-2 border-gray-300 py-2 tracking-tight text-sm md:text-base font-semibold"
    >
      <h5>Stock Symbol</h5>
      <h5>No. of Shares</h5>
      <h5>Cost of Shares</h5>
      <h5>Current Value</h5>
      <h5>Profit/Loss</h5>
    </div>
    {% for stock in portfolio %}
    <div class="grid grid-cols-5 py-2 text-sm md:text-base">
      <div class="font-light">{{ stock.stock }}</div>
      <div class="font-light">{{ stock.no_of_shares }}</div>
      <div class="font-light">{{ stock.total_cost|usd }}</div>
      <div class="font-light">{{ stock.market_value|usd }}</div>
      <div class="font-light font-semibold">
        {% if stock.profit_loss < 0 %}
        <p class="text-red-700">{{ stock.profit_loss|usd }}</p>
        {% else %}
        <p class="text-green-700">{{ stock.profit_loss|usd }}</p>
        {% endif %}
      </div>
    </div>
    {% endfor %}
    <div class="finstats border-t-2 border-gray-300 pt-4 text-sm md:text-base">
      <div class="grid grid-cols-2 py-2">
        <div class="font-semibold">Total Share Market Value</div>
        <div class="font-light ml-4">{{ total_share_value|usd }}</div>
      </div>
      <div class="grid grid-cols-2 py-2">
        <div class="font-semibold">Remaining Cash</div>
        <div class="font-light ml-4">{{ cash|usd }}</div>
      </div>
      <div class="grid grid-cols-2 py-2">
        <div class="font-semibold">Total Equity</div>
        <div class="font-light ml-4">{{ (cash + total_share_value)|usd }}</div>
      </div>
      <div class="grid grid-cols-2 py-2">
        <div class="font-semibold">Net Gain/Loss</div>
        <div class="font-semibold ml-4">
          {% if (cash + total_share_value - 10000) < 0 %}
          <p class="text-red-700">
            {{ (cash + total_share_value - 10000)|usd }}
          </p>
          {% else %}
          <p class="text-green-700">
            {{ (cash + total_share_value - 10000)|usd }}
          </p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>


{% endblock %}
